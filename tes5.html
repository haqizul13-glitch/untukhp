<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>Nuqthah Learn</title>

    <style>
        /* =========================
      Nuqthah Learn — Ultra Premium SPA (Single File) — Production-ready refactor
      Keep Features:
      - Hero + stats + CTA
      - Search + category chips filter
      - Slider dots + auto-scroll (pause on hover)
      - Modal preview (no langsung open link)
      - Toast notification
      - Dark mode + remember preference
      - Skeleton shimmer
      - Reduced-motion support
      Add:
      - SPA Route (Home <-> Explore <-> Tips <-> Belajar) + Premium Transitions
      - Learn Focus Mode (sidebar + viewer + notes + progress)
      - Local progress saved
      Notes:
      - Tidak mengubah desain utama
      - Tidak menghapus fungsi apa pun
      - Tidak auto-scroll halaman (kecuali slider otomatis geser samping)
    ========================= */

        :root {
            --bg: #f6f7fb;
            --bg2: #eef2ff;
            --surface: rgba(255, 255, 255, 0.78);
            --surface-strong: rgba(255, 255, 255, 0.92);
            --surface-solid: #ffffff;

            --text: #0f172a;
            --muted: #64748b;
            --border: rgba(15, 23, 42, 0.10);

            --primary: #2563eb;
            --primary2: #4f46e5;
            --accent: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;

            --shadow-sm: 0 8px 22px rgba(15, 23, 42, 0.06);
            --shadow-md: 0 18px 60px rgba(15, 23, 42, 0.12);
            --shadow-xl: 0 34px 120px rgba(15, 23, 42, 0.16);
            --shadow-glow: 0 20px 60px rgba(37, 99, 235, 0.22);

            --radius-xl: 28px;
            --radius-lg: 22px;
            --radius-md: 16px;
            --radius-sm: 12px;

            --container: 1120px;
            --ring: 0 0 0 4px rgba(37, 99, 235, 0.18);
            --blur: 14px;

            --ease: cubic-bezier(.2, .9, .2, 1);
        }

        body.dark {
            --bg: #050816;
            --bg2: #0b1028;
            --surface: rgba(15, 23, 42, 0.66);
            --surface-strong: rgba(15, 23, 42, 0.82);
            --surface-solid: #0b1220;

            --text: #e5e7eb;
            --muted: #a3adc2;
            --border: rgba(255, 255, 255, 0.10);

            --shadow-sm: 0 10px 26px rgba(0, 0, 0, 0.28);
            --shadow-md: 0 26px 80px rgba(0, 0, 0, 0.35);
            --shadow-xl: 0 50px 140px rgba(0, 0, 0, 0.42);
            --shadow-glow: 0 24px 70px rgba(79, 70, 229, 0.25);

            --ring: 0 0 0 4px rgba(99, 102, 241, 0.22);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background:
                radial-gradient(1200px 600px at 20% -10%, rgba(37, 99, 235, 0.11), transparent 60%),
                radial-gradient(900px 500px at 90% 10%, rgba(99, 102, 241, 0.10), transparent 55%),
                radial-gradient(900px 520px at 40% 110%, rgba(34, 197, 94, 0.07), transparent 55%),
                linear-gradient(180deg, var(--bg2), var(--bg));
            color: var(--text);
            line-height: 1.55;
            overflow-x: hidden;
        }

        .container {
            width: min(var(--container), calc(100% - 44px));
            margin: 0 auto;
        }

        /* subtle grain overlay */
        .grain {
            pointer-events: none;
            position: fixed;
            inset: 0;
            opacity: 0.07;
            mix-blend-mode: overlay;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
            z-index: 1;
        }

        /* =========================
      Premium SPA transitions
    ========================= */
        .app {
            position: relative;
            z-index: 2;
            min-height: 100dvh;
        }

        .route {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity .45s var(--ease), transform .55s var(--ease);
            will-change: opacity, transform;
        }

        .route.active {
            display: block;
        }

        .route.enter {
            opacity: 1;
            transform: translateY(0);
        }

        .route.leave {
            opacity: 0;
            transform: translateY(12px);
        }

        .page-shell {
            padding-bottom: 28px;
        }

        /* =========================
      TOP NAV
    ========================= */
        .top-nav {
            position: sticky;
            top: 0;
            z-index: 50;
            background: color-mix(in srgb, var(--bg) 60%, transparent);
            backdrop-filter: blur(var(--blur));
            border-bottom: 1px solid var(--border);
        }

        .nav-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0;
            gap: 14px;
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
            min-width: 220px;
            cursor: pointer;
            user-select: none;
        }

        .brand-mark {
            width: 40px;
            height: 40px;
            border-radius: 16px;
            display: grid;
            place-items: center;
            color: white;
            font-weight: 950;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            box-shadow: var(--shadow-glow);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .brand-mark::after {
            content: "";
            position: absolute;
            inset: -1px;
            border-radius: 16px;
            background: radial-gradient(70% 70% at 30% 20%, rgba(255, 255, 255, 0.35), transparent 55%);
            pointer-events: none;
        }

        .brand-text strong {
            display: block;
            font-size: 14px;
            letter-spacing: 0.2px;
            font-weight: 950;
        }

        .brand-text span {
            display: block;
            font-size: 12px;
            color: var(--muted);
            margin-top: 1px;
            font-weight: 750;
        }

        .nav-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .btn {
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 78%, transparent);
            color: var(--text);
            padding: 10px 14px;
            border-radius: 14px;
            font-weight: 850;
            cursor: pointer;
            transition: transform .22s var(--ease), box-shadow .22s var(--ease), background .22s var(--ease), border-color .22s var(--ease), filter .22s var(--ease);
            box-shadow: var(--shadow-sm);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
            filter: brightness(0.99);
        }

        .btn:focus {
            outline: none;
            box-shadow: var(--shadow-sm), var(--ring);
        }

        /* extra: focus-visible for keyboard users */
        .btn:focus:not(:focus-visible) {
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            color: white;
            box-shadow: var(--shadow-glow);
        }

        .btn-soft {
            border: 1px solid color-mix(in srgb, var(--primary) 18%, var(--border));
            background:
                radial-gradient(380px 160px at 20% 0%, rgba(37, 99, 235, 0.16), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 78%, transparent);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: grid;
            place-items: center;
            border-radius: 14px;
        }

        .kbd {
            font-size: 11px;
            padding: 3px 7px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            color: color-mix(in srgb, var(--text) 82%, var(--muted));
            font-weight: 900;
        }

        /* =========================
      HERO
    ========================= */
        header {
            padding: 18px 0 10px;
            position: relative;
        }

        .hero {
            display: grid;
            grid-template-columns: 1.25fr .75fr;
            gap: 16px;
            align-items: stretch;
        }

        .hero-card {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-xl);
            padding: 22px;
            position: relative;
            overflow: hidden;
        }

        .hero-card::before {
            content: "";
            position: absolute;
            inset: -1px;
            background:
                radial-gradient(900px 380px at 10% 0%, rgba(37, 99, 235, 0.18), transparent 55%),
                radial-gradient(700px 320px at 90% 20%, rgba(99, 102, 241, 0.14), transparent 60%),
                radial-gradient(700px 280px at 50% 120%, rgba(34, 197, 94, 0.10), transparent 55%);
            pointer-events: none;
            opacity: 0.95;
        }

        .hero-top {
            position: relative;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
        }

        .hero-title h1 {
            font-size: 30px;
            font-weight: 1000;
            letter-spacing: -0.8px;
            line-height: 1.05;
        }

        .hero-title p {
            margin-top: 8px;
            color: var(--muted);
            font-size: 14px;
            max-width: 62ch;
            font-weight: 750;
        }

        .pill {
            position: relative;
            padding: 10px 12px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            color: color-mix(in srgb, var(--text) 90%, var(--muted));
            font-size: 12px;
            font-weight: 950;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
        }

        .hero-cta {
            position: relative;
            margin-top: 16px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .hero-stats {
            position: relative;
            margin-top: 16px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat {
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 72%, transparent);
            border-radius: 18px;
            padding: 12px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .stat::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(280px 120px at 20% 0%, rgba(37, 99, 235, 0.14), transparent 60%);
            opacity: 0.8;
            pointer-events: none;
        }

        .stat b {
            position: relative;
            display: block;
            font-weight: 1000;
            font-size: 15px;
            letter-spacing: -0.2px;
        }

        .stat span {
            position: relative;
            display: block;
            margin-top: 3px;
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
        }

        .hero-side {
            display: grid;
            gap: 12px;
        }

        .mini-card {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-sm);
            padding: 16px;
            overflow: hidden;
            position: relative;
        }

        .mini-card::before {
            content: "";
            position: absolute;
            inset: -1px;
            background: radial-gradient(520px 220px at 10% 0%, rgba(99, 102, 241, 0.12), transparent 55%);
            pointer-events: none;
            opacity: 0.9;
        }

        .mini-card h3 {
            position: relative;
            font-size: 14px;
            font-weight: 1000;
            letter-spacing: -0.2px;
        }

        .mini-card p {
            position: relative;
            margin-top: 6px;
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
            max-width: 52ch;
        }

        .mini-row {
            position: relative;
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chip {
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            border-radius: 999px;
            padding: 8px 10px;
            font-size: 12px;
            font-weight: 900;
            color: color-mix(in srgb, var(--text) 90%, var(--muted));
            cursor: pointer;
            transition: transform .18s var(--ease), box-shadow .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease);
            box-shadow: var(--shadow-sm);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .chip:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .chip:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .chip.active {
            border-color: color-mix(in srgb, var(--primary) 35%, var(--border));
            background:
                radial-gradient(260px 120px at 20% 0%, rgba(37, 99, 235, 0.18), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        /* =========================
      SECTION
    ========================= */
        .section {
            padding: 18px 0 26px;
            position: relative;
        }

        .section-title {
            font-size: 18px;
            font-weight: 1000;
            letter-spacing: -0.3px;
            margin-bottom: 14px;
        }

        .toolbar {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
            margin: 14px 0 16px;
        }

        .search {
            position: relative;
        }

        .search input {
            width: 100%;
            padding: 14px 44px 14px 42px;
            border-radius: 18px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            box-shadow: var(--shadow-sm);
            color: var(--text);
            font-size: 14px;
            font-weight: 800;
            outline: none;
            transition: box-shadow .2s var(--ease), border-color .2s var(--ease), background .2s var(--ease);
        }

        .search input:focus {
            box-shadow: var(--shadow-sm), var(--ring);
            border-color: color-mix(in srgb, var(--primary) 30%, var(--border));
            background: color-mix(in srgb, var(--surface-solid) 84%, transparent);
        }

        .search .icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.75;
            font-size: 16px;
            user-select: none;
        }

        .search .clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 34px;
            height: 34px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            cursor: pointer;
            font-weight: 1000;
            color: color-mix(in srgb, var(--text) 80%, var(--muted));
            display: none;
            box-shadow: var(--shadow-sm);
            transition: transform .2s var(--ease), box-shadow .2s var(--ease);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .search .clear:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-50%) translateY(-1px);
        }

        .toolbar-right {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
        }

        /* =========================
      SLIDER
    ========================= */
        .slider-wrap {
            position: relative;
        }

        .slider {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 6px 2px 12px 2px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .slider::-webkit-scrollbar {
            height: 10px;
        }

        .slider::-webkit-scrollbar-thumb {
            background: rgba(15, 23, 42, 0.14);
            border-radius: 999px;
        }

        body.dark .slider::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.16);
        }

        .slide {
            scroll-snap-align: start;
            min-width: 320px;
            height: 205px;
            border-radius: var(--radius-xl);
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            background: #000;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: transform .25s var(--ease), box-shadow .25s var(--ease);
            outline: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .slide:hover {
            transform: translateY(-3px);
            box-shadow: 0 24px 70px rgba(15, 23, 42, 0.18);
        }

        .slide:focus {
            box-shadow: var(--shadow-md), var(--ring);
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scale(1.02);
            transition: transform .35s var(--ease);
            filter: saturate(1.06);
        }

        .slide:hover img {
            transform: scale(1.07);
        }

        .slide::after {
            content: "";
            position: absolute;
            inset: 0;
            background:
                linear-gradient(to top, rgba(0, 0, 0, 0.78), rgba(0, 0, 0, 0.12) 60%, rgba(0, 0, 0, 0)),
                radial-gradient(600px 220px at 20% 0%, rgba(37, 99, 235, 0.22), transparent 60%);
            pointer-events: none;
        }

        .slide .tag {
            position: absolute;
            top: 14px;
            left: 14px;
            z-index: 2;
            font-size: 12px;
            font-weight: 1000;
            color: rgba(255, 255, 255, 0.92);
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.16);
            padding: 6px 10px;
            border-radius: 999px;
            backdrop-filter: blur(8px);
        }

        .slide .badge-right {
            position: absolute;
            top: 14px;
            right: 14px;
            z-index: 2;
            font-size: 11px;
            font-weight: 1000;
            color: white;
            padding: 6px 10px;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(16, 185, 129, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 18px 50px rgba(34, 197, 94, 0.18);
        }

        .slide span {
            position: absolute;
            left: 16px;
            bottom: 16px;
            z-index: 2;
            color: white;
            font-size: 16px;
            font-weight: 1000;
            letter-spacing: -0.2px;
            text-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);
        }

        .dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
            opacity: 0.95;
            user-select: none;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: rgba(100, 116, 139, 0.35);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform .2s var(--ease), width .2s var(--ease), background .2s var(--ease);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .dot.active {
            width: 20px;
            background: color-mix(in srgb, var(--primary) 60%, rgba(100, 116, 139, 0.35));
            transform: translateY(-1px);
        }

        /* =========================
      GRID
    ========================= */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .class-card {
            position: relative;
            border: 1px solid var(--border);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            padding: 18px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            overflow: hidden;
            transition: transform .22s var(--ease), box-shadow .22s var(--ease), background .22s var(--ease), border-color .22s var(--ease);
            outline: none;
            min-height: 132px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .class-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: color-mix(in srgb, var(--primary) 20%, var(--border));
        }

        .class-card:active {
            transform: translateY(-1px);
        }

        .class-card:focus {
            box-shadow: var(--shadow-md), var(--ring);
        }

        .class-card::before {
            content: "";
            position: absolute;
            inset: -1px;
            background: radial-gradient(520px 220px at 10% 0%, rgba(37, 99, 235, 0.16), transparent 55%);
            opacity: 0;
            transition: opacity .22s var(--ease);
            pointer-events: none;
        }

        .class-card:hover::before {
            opacity: 1;
        }

        .class-card h3 {
            font-size: 16px;
            font-weight: 1000;
            letter-spacing: -0.25px;
            margin-bottom: 6px;
            position: relative;
            z-index: 2;
        }

        .class-card p {
            font-size: 13px;
            color: var(--muted);
            font-weight: 800;
            position: relative;
            z-index: 2;
            max-width: 36ch;
        }

        .meta {
            margin-top: 12px;
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            color: color-mix(in srgb, var(--text) 85%, var(--muted));
            font-size: 12px;
            font-weight: 900;
            position: relative;
            z-index: 2;
            box-shadow: var(--shadow-sm);
        }

        .badge {
            position: absolute;
            top: 14px;
            right: 14px;
            font-size: 11px;
            font-weight: 1000;
            letter-spacing: 0.4px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            z-index: 2;
        }

        .badge.new {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.95), rgba(79, 70, 229, 0.95));
        }

        .badge.popular {
            background: linear-gradient(135deg, rgba(244, 63, 94, 0.95), rgba(245, 158, 11, 0.95));
        }

        .badge.premium {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.95), rgba(249, 115, 22, 0.95));
            box-shadow: 0 18px 55px rgba(245, 158, 11, 0.22);
        }

        .class-card.elite {
            background: linear-gradient(135deg, #0b1220, #1f2a44);
            border: 1px solid rgba(255, 255, 255, 0.10);
            color: white;
            box-shadow: 0 26px 90px rgba(2, 6, 23, 0.35);
        }

        .class-card.elite p {
            color: rgba(255, 255, 255, 0.75);
        }

        .class-card.elite .meta {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.14);
            color: rgba(255, 255, 255, 0.88);
        }

        .class-card.elite::before {
            background: radial-gradient(520px 240px at 10% 0%, rgba(99, 102, 241, 0.35), transparent 55%);
        }

        /* =========================
      REGISTER
    ========================= */
        .register-panel {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-md);
            padding: 26px 18px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .register-panel::before {
            content: "";
            position: absolute;
            inset: -1px;
            background: radial-gradient(900px 340px at 50% 0%, rgba(37, 99, 235, 0.18), transparent 60%);
            pointer-events: none;
        }

        .register-panel h2 {
            position: relative;
            font-size: 22px;
            font-weight: 1000;
            letter-spacing: -0.4px;
        }

        .register-panel p {
            position: relative;
            color: var(--muted);
            margin-top: 6px;
            margin-bottom: 14px;
            font-size: 14px;
            font-weight: 800;
        }

        .primary-btn {
            position: relative;
            padding: 14px 22px;
            font-size: 15px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            color: #fff;
            font-weight: 1000;
            cursor: pointer;
            box-shadow: var(--shadow-glow);
            transition: transform .2s var(--ease), box-shadow .2s var(--ease), filter .2s var(--ease);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 26px 80px rgba(37, 99, 235, 0.30);
            filter: brightness(1.02);
        }

        .primary-btn:active {
            transform: translateY(-1px);
        }

        .sub-note {
            position: relative;
            margin-top: 10px;
            font-size: 12px;
            color: color-mix(in srgb, var(--muted) 90%, var(--text));
            font-weight: 800;
        }

        footer {
            padding: 22px 0 28px;
            font-size: 13px;
            color: color-mix(in srgb, var(--muted) 92%, var(--text));
            text-align: center;
            position: relative;
            z-index: 2;
        }

        /* =========================
      MODAL (FIXED)
    ========================= */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
            z-index: 200;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            width: min(900px, 100%);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 82%, transparent);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            transform: translateY(10px);
            opacity: 0;
            transition: transform .22s var(--ease), opacity .22s var(--ease);
        }

        .modal-overlay.show .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            border-bottom: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        .modal-title {
            display: grid;
            gap: 2px;
        }

        .modal-title strong {
            font-size: 14px;
            font-weight: 1000;
            letter-spacing: -0.2px;
        }

        .modal-title span {
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 72%, transparent);
            cursor: pointer;
            font-weight: 1000;
            box-shadow: var(--shadow-sm);
            transition: transform .2s var(--ease), box-shadow .2s var(--ease);
            color: color-mix(in srgb, var(--text) 86%, var(--muted));
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .modal-close:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .modal-body {
            padding: 16px;
            display: grid;
            grid-template-columns: 1.1fr .9fr;
            gap: 14px;
        }

        .preview {
            border-radius: 22px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 76%, transparent);
            min-height: 260px;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .preview .ph {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            font-weight: 1000;
            color: color-mix(in srgb, var(--text) 70%, var(--muted));
            background:
                radial-gradient(500px 220px at 15% 0%, rgba(37, 99, 235, 0.14), transparent 60%),
                radial-gradient(520px 240px at 90% 10%, rgba(99, 102, 241, 0.12), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        .preview iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: none;
        }

        .preview.ready iframe {
            display: block;
        }

        .preview.ready .ph {
            display: none;
        }

        .modal-info {
            border: 1px solid var(--border);
            border-radius: 22px;
            background: color-mix(in srgb, var(--surface-solid) 72%, transparent);
            box-shadow: var(--shadow-sm);
            padding: 14px;
            display: grid;
            gap: 10px;
        }

        .info-row {
            display: grid;
            gap: 6px;
        }

        .info-row p {
            font-size: 13px;
            color: var(--muted);
            font-weight: 800;
            line-height: 1.5;
        }

        .info-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 2px;
        }

        .tiny {
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            font-weight: 900;
            color: color-mix(in srgb, var(--text) 86%, var(--muted));
        }

        .modal-actions {
            padding: 14px 16px 16px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        /* =========================
      TOAST
    ========================= */
        .toast {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 300;
            width: min(360px, calc(100% - 36px));
            border: 1px solid var(--border);
            border-radius: 18px;
            background: color-mix(in srgb, var(--surface-solid) 82%, transparent);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-xl);
            padding: 12px 12px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 10px;
            align-items: center;
            transform: translateY(14px);
            opacity: 0;
            pointer-events: none;
            transition: transform .22s var(--ease), opacity .22s var(--ease);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .toast .dotty {
            width: 12px;
            height: 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--accent), #10b981);
            box-shadow: 0 18px 55px rgba(34, 197, 94, 0.22);
        }

        .toast strong {
            font-size: 12px;
            font-weight: 1000;
            letter-spacing: -0.1px;
        }

        .toast span {
            display: block;
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
            margin-top: 1px;
        }

        .toast button {
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            border-radius: 12px;
            width: 34px;
            height: 34px;
            cursor: pointer;
            font-weight: 1000;
            color: color-mix(in srgb, var(--text) 82%, var(--muted));
            box-shadow: var(--shadow-sm);
            transition: transform .2s var(--ease), box-shadow .2s var(--ease);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .toast button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* =========================
      SKELETON
    ========================= */
        .skeleton {
            position: relative;
            overflow: hidden;
            border-radius: 18px;
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            border: 1px solid var(--border);
            min-height: 132px;
        }

        .shimmer::after {
            content: "";
            position: absolute;
            inset: 0;
            transform: translateX(-60%);
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.35), transparent);
            animation: shimmer 1.1s linear infinite;
            opacity: 0.7;
        }

        body.dark .shimmer::after {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.12), transparent);
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-60%);
            }

            100% {
                transform: translateX(60%);
            }
        }

        /* =========================
      LEARN PAGE (Focus Mode)
    ========================= */
        .learn-shell {
            padding: 16px 0 26px;
        }

        .learn-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .learn-head h2 {
            font-size: 18px;
            font-weight: 1000;
            letter-spacing: -0.25px;
        }

        .learn-head p {
            font-size: 12px;
            font-weight: 800;
            color: var(--muted);
            margin-top: 3px;
        }

        .learn-layout {
            display: grid;
            grid-template-columns: 330px 1fr;
            gap: 14px;
            align-items: start;
        }

        .panel {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .panel-hd {
            padding: 14px 14px;
            border-bottom: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .panel-hd strong {
            font-size: 13px;
            font-weight: 1000;
            letter-spacing: -0.2px;
        }

        .panel-hd .small {
            font-size: 11px;
            font-weight: 900;
            color: color-mix(in srgb, var(--text) 78%, var(--muted));
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            padding: 6px 10px;
            border-radius: 999px;
            user-select: none;
        }

        .lesson-list {
            padding: 10px;
            display: grid;
            gap: 10px;
            max-height: calc(100dvh - 230px);
            overflow: auto;
            overscroll-behavior: contain;
        }

        .lesson-item {
            border: 1px solid var(--border);
            border-radius: 18px;
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            box-shadow: var(--shadow-sm);
            padding: 12px;
            cursor: pointer;
            transition: transform .2s var(--ease), box-shadow .2s var(--ease), border-color .2s var(--ease);
            display: grid;
            gap: 6px;
            position: relative;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .lesson-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: color-mix(in srgb, var(--primary) 22%, var(--border));
        }

        .lesson-item.active {
            border-color: color-mix(in srgb, var(--primary) 34%, var(--border));
            box-shadow: var(--shadow-md), var(--ring);
        }

        .lesson-item b {
            font-size: 13px;
            font-weight: 1000;
            letter-spacing: -0.1px;
        }

        .lesson-item small {
            font-size: 11px;
            color: var(--muted);
            font-weight: 850;
            line-height: 1.45;
        }

        .lesson-item .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 2px;
        }

        .pill-mini {
            font-size: 11px;
            font-weight: 950;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            color: color-mix(in srgb, var(--text) 88%, var(--muted));
            user-select: none;
        }

        .pill-mini.ok {
            border-color: color-mix(in srgb, var(--accent) 28%, var(--border));
            background: radial-gradient(260px 120px at 20% 0%, rgba(34, 197, 94, 0.16), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        .pill-mini.warn {
            border-color: color-mix(in srgb, var(--warning) 32%, var(--border));
            background: radial-gradient(260px 120px at 20% 0%, rgba(245, 158, 11, 0.16), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        .pill-mini.lock {
            border-color: color-mix(in srgb, var(--primary) 22%, var(--border));
            background: radial-gradient(260px 120px at 20% 0%, rgba(37, 99, 235, 0.16), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 70%, transparent);
        }

        .learn-main {
            display: grid;
            gap: 14px;
        }

        .viewer {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-md);
            overflow: hidden;
            position: relative;
            min-height: 420px;
        }

        .viewer-hd {
            padding: 14px 14px;
            border-bottom: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .viewer-hd .title {
            display: grid;
            gap: 2px;
        }

        .viewer-hd .title strong {
            font-size: 13px;
            font-weight: 1000;
            letter-spacing: -0.2px;
        }

        .viewer-hd .title span {
            font-size: 11px;
            color: var(--muted);
            font-weight: 850;
        }

        .viewer-body {
            position: relative;
            min-height: 380px;
            background:
                radial-gradient(900px 420px at 10% 0%, rgba(37, 99, 235, 0.10), transparent 60%),
                radial-gradient(900px 420px at 90% 10%, rgba(99, 102, 241, 0.08), transparent 60%),
                color-mix(in srgb, var(--surface-solid) 62%, transparent);
        }

        .viewer-body iframe {
            width: 100%;
            height: 420px;
            border: 0;
            display: block;
            background: transparent;
        }

        .viewer-empty {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            padding: 18px;
            text-align: center;
            color: color-mix(in srgb, var(--text) 72%, var(--muted));
            font-weight: 900;
        }

        .notes {
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            background: var(--surface);
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .notes .panel-hd {
            border-bottom: 1px solid var(--border);
        }

        .notes textarea {
            width: 100%;
            min-height: 180px;
            border: 0;
            outline: none;
            resize: vertical;
            padding: 14px;
            background: transparent;
            color: var(--text);
            font-size: 13px;
            font-weight: 800;
            line-height: 1.6;
        }

        .progress {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .bar {
            flex: 1 1 220px;
            height: 12px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--surface-solid) 70%, transparent);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .bar>i {
            display: block;
            height: 100%;
            width: 0%;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            border-radius: 999px;
            box-shadow: 0 18px 55px rgba(37, 99, 235, 0.22);
            transition: width .35s var(--ease);
        }

        .muted {
            color: var(--muted);
            font-weight: 850;
            font-size: 12px;
        }

        /* =========================
      Reduced motion support
    ========================= */
        @media (prefers-reduced-motion: reduce) {
            html {
                scroll-behavior: auto;
            }

            .route,
            .btn,
            .chip,
            .slide,
            .class-card,
            .modal,
            .toast,
            .lesson-item,
            .bar>i {
                transition: none !important;
                animation: none !important;
            }

            .slide img {
                transition: none !important;
            }

            .shimmer::after {
                animation: none !important;
            }
        }

        /* =========================
      Responsive
    ========================= */
        @media (max-width: 980px) {
            .hero {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .learn-layout {
                grid-template-columns: 1fr;
            }

            .lesson-list {
                max-height: 280px;
            }

            .viewer-body iframe {
                height: 380px;
            }
        }

        @media (max-width: 520px) {
            .brand {
                min-width: unset;
            }

            .hero-title h1 {
                font-size: 26px;
            }

            .slide {
                min-width: 280px;
                height: 190px;
            }

            .hero-stats {
                grid-template-columns: 1fr;
            }
        }

        /* =========================
      NAVBAR MOBILE FIX (requested)
      - Tidak mengubah desktop
      - Tinggi/padding diperkecil khusus layar kecil
      - Posisi & fungsi tombol tetap sama
    ========================= */
        @media (max-width: 520px) {
            .nav-inner {
                padding: 10px 0;
                gap: 10px;
            }

            .brand {
                gap: 10px;
            }

            .brand-mark {
                width: 34px;
                height: 34px;
                border-radius: 14px;
            }

            .brand-text strong {
                font-size: 13px;
            }

            .brand-text span {
                font-size: 11px;
                margin-top: 0px;
            }

            .nav-actions {
                gap: 8px;
            }

            .btn {
                padding: 8px 10px;
                border-radius: 13px;
                gap: 6px;
            }

            .btn-icon {
                width: 36px;
                height: 36px;
                border-radius: 13px;
            }

            .kbd {
                font-size: 10px;
                padding: 2px 6px;
                border-radius: 9px;
            }
        }

        /* =========================
   MOBILE NAV — COMPACT & NO WRAP
   Fix: navbar tinggi + tombol kebesaran
========================= */
        @media (max-width: 520px) {
            .top-nav {
                backdrop-filter: blur(var(--blur));
            }

            .nav-inner {
                padding: 8px 0;
                /* lebih tipis */
                gap: 8px;
                align-items: center;
            }

            /* brand jangan makan tempat */
            .brand-text span {
                display: none;
                /* sembunyikan subtitle di mobile */
            }

            .brand-mark {
                width: 32px;
                height: 32px;
                border-radius: 12px;
            }

            .brand-text strong {
                font-size: 13px;
                line-height: 1.1;
            }

            /* tombol jangan turun baris */
            .nav-actions {
                flex-wrap: nowrap;
                /* penting! biar ga jadi 2 baris */
                overflow-x: auto;
                /* kalau sempit, bisa geser samping */
                max-width: 60vw;
                gap: 6px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .nav-actions::-webkit-scrollbar {
                display: none;
            }

            /* tombol diperkecil */
            .btn {
                padding: 7px 9px;
                border-radius: 12px;
                font-size: 12px;
                box-shadow: var(--shadow-sm);
            }

            .btn-icon {
                width: 34px;
                height: 34px;
                border-radius: 12px;
            }

            /* kbd hidden biar hemat tempat */
            .kbd {
                display: none;
            }
        }

        /* Extra kecil (HP sempit banget) → ikon aja */
        @media (max-width: 420px) {
            .btn span {
                display: none;
                /* tinggal emoji nya saja */
            }

            .btn {
                padding: 7px 8px;
            }

            .nav-actions {
                max-width: 55vw;
            }
        }

        /* Fix navbar lebih transparan di desktop dan mobile */
        .top-nav {
            background: color-mix(in srgb, var(--bg) 20%, transparent);
            /* lebih transparan dari sebelumnya */
            backdrop-filter: blur(10px);
            /* optional: blur tetap ada */
            box-shadow: none;
            /* jika ingin hilangkan shadow */
        }

        /* Mobile: lebih transparan */
        @media (max-width: 520px) {
            .top-nav {
                background: color-mix(in srgb, var(--bg) 15%, transparent);
                /* lebih transparan di mobile */
            }
        }


        /* FIX: Hero title jadi sempit karena pill sejajar di mobile */
        @media (max-width: 520px) {
            .hero-top {
                flex-direction: column;
                /* dari sejajar -> bertumpuk */
                align-items: flex-start;
                gap: 10px;
            }

            .pill {
                align-self: flex-start;
                /* pill tidak memaksa lebar judul */
                white-space: nowrap;
            }

            /* kasih lebar penuh untuk teks */
            .hero-title {
                width: 100%;
            }

            /* opsional: biar paragraf tidak dibatasi */
            .hero-title p {
                max-width: none;
                /* hilangkan batas 62ch di mobile */
            }
        }

        @media (max-width: 520px) {
            .container {
                width: min(var(--container), calc(100% - 28px));
                /* sebelumnya 44px */
            }
        }

        @media (max-width: 520px) {
            #categoryChips {
                margin-bottom: 16px;
            }

            #classGrid,
            #skeletonGrid {
                margin-top: 10px;
            }
        }

        /* Saat ganti tema: bikin perubahan warna instan (anti lag) */
        body.theme-switching *,
        body.theme-switching *::before,
        body.theme-switching *::after {
            transition: none !important;
            animation: none !important;
        }
    </style>
</head>

<body>
    <div class="grain"></div>

    <div class="app" id="app">
        <!-- =========================
         TOP NAV (SPA)
    ========================= -->
        <div class="top-nav">
            <div class="container">
                <div class="nav-inner">
                    <div class="brand" role="button" tabindex="0" data-go="home" aria-label="Kembali ke Beranda">
                        <div class="brand-mark">R</div>
                        <div class="brand-text">
                            <strong>Ruang Azhary</strong>
                            <span>SPA • Fokus belajar, rapi & premium</span>
                        </div>
                    </div>

                    <div class="nav-actions">
                        <button class="btn btn-soft" type="button" data-go="explore" aria-label="Buka Explore">
                            🔎 <span>Explore</span> <span class="kbd">E</span>
                        </button>
                        <button class="btn btn-soft" type="button" data-go="tips" aria-label="Buka Tips Fokus">
                            🎯 <span>Tips Fokus</span> <span class="kbd">T</span>
                        </button>
                        <button class="btn btn-primary" type="button" data-go="belajar" aria-label="Mulai Belajar">
                            ✨ <span>Mulai Belajar</span> <span class="kbd">L</span>
                        </button>
                        <button class="btn btn-icon" id="darkToggle" type="button" aria-label="Toggle Dark Mode"
                            title="Dark Mode">
                            🌙
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- =========================
         ROUTES (SPA)
    ========================= -->
        <main class="page-shell">
            <!-- ROUTE: HOME -->
            <section class="route active enter" id="route-home" data-route="home">
                <header>
                    <div class="container">
                        <div class="hero">
                            <div class="hero-card">
                                <div class="hero-top">
                                    <div class="hero-title">
                                        <h1>Belajar terasa lebih ringan — tetap premium, tetap rapi.</h1>
                                        <p>
                                            Jelajahi materi dengan filter cepat, preview aman via modal, dan mode
                                            belajar fokus yang menyimpan progres otomatis.
                                            Semua tetap single-file, tapi UX-nya “kelas atas”.
                                        </p>
                                    </div>
                                    <div class="pill">⚡ Ultra Premium SPA</div>
                                </div>

                                <div class="hero-cta">
                                    <button class="btn btn-primary" type="button" data-go="belajar">Mulai
                                        Belajar</button>
                                    <button class="btn btn-soft" type="button" data-go="explore">Explore Materi</button>
                                    <button class="btn" type="button" data-go="tips">Tips Fokus</button>
                                    <span class="kbd" title="Shortcut">/ Search</span>
                                </div>

                                <div class="hero-stats">
                                    <div class="stat">
                                        <b id="statTotal">—</b>
                                        <span>Total materi</span>
                                    </div>
                                    <div class="stat">
                                        <b id="statProgress">—</b>
                                        <span>Progres kamu</span>
                                    </div>
                                    <div class="stat">
                                        <b id="statStreak">—</b>
                                        <span>Streak belajar</span>
                                    </div>
                                </div>
                            </div>

                            <div class="hero-side">
                                <div class="mini-card">
                                    <h3>Filter cepat 🚀</h3>
                                    <p>Gunakan chip kategori + pencarian. Hasilnya update real-time, plus skeleton
                                        shimmer untuk loading halus.</p>
                                    <div class="mini-row" id="homeQuickChips"></div>
                                </div>

                                <div class="mini-card">
                                    <h3>Mode belajar fokus ✍️</h3>
                                    <p>Sidebar materi, viewer, catatan, dan progress bar. Progres & catatan disimpan
                                        otomatis di perangkat kamu.</p>
                                    <div class="mini-row">
                                        <span class="chip" data-go="belajar">Buka Mode Fokus</span>
                                        <span class="chip" data-go="tips">Ritual Fokus</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Featured slider -->
                <section class="section">
                    <div class="container">
                        <div class="section-title">Pilihan materi 🔥</div>

                        <div class="slider-wrap">
                            <div class="slider" id="featuredSlider" aria-label="Slider materi unggulan"></div>
                            <div class="dots" id="sliderDots" aria-label="Navigasi slider"></div>
                        </div>
                    </div>
                </section>

                <!-- CTA / Register -->
                <section class="section">
                    <div class="container">
                        <div class="register-panel">
                            <h2>Siap serius belajar hari ini?</h2>
                            <p>Mulai dari materi ringan → lanjut ke fokus mode. Progres kamu aman tersimpan.</p>
                            <button class="primary-btn" type="button" data-go="belajar">Mulai Belajar Sekarang</button>
                            <div class="sub-note">Tip: hover slider untuk pause auto-scroll 🧊</div>
                        </div>
                    </div>
                </section>

                <footer class="container">© <span id="year"></span> Nuqthah Learn — Single File SPA • Premium UX
                </footer>
            </section>

            <!-- ROUTE: EXPLORE -->
            <section class="route" id="route-explore" data-route="explore">
                <section class="section">
                    <div class="container">
                        <div class="section-title">Explore Materi 🔎</div>

                        <div class="toolbar">
                            <div class="search">
                                <div class="icon">🔎</div>
                                <input id="searchInput" type="text"
                                    placeholder="Cari materi… (contoh: grammar, speaking, TOEFL, dll)"
                                    autocomplete="off" />
                                <button class="clear" id="clearSearch" type="button"
                                    aria-label="Hapus pencarian">×</button>
                            </div>

                            <div class="toolbar-right">
                                <button class="btn" type="button" id="resetFilters">Reset</button>
                                <button class="btn btn-primary" type="button" data-go="belajar">Fokus Mode</button>
                            </div>
                        </div>

                        <div class="mini-row" id="categoryChips"></div>

                        <div class="card-grid" id="classGrid" aria-label="Daftar materi"></div>
                        <div class="card-grid" id="skeletonGrid" style="display:none;"></div>

                        <footer class="container" style="padding-top:18px;">Tip: klik kartu untuk preview via modal
                            (nggak langsung
                            buka link).</footer>
                    </div>
                </section>
            </section>

            <!-- ROUTE: TIPS -->
            <section class="route" id="route-tips" data-route="tips">
                <section class="section">
                    <div class="container">
                        <div class="section-title">Tips Fokus 🎯</div>

                        <div class="card-grid">
                            <div class="class-card elite" tabindex="0">
                                <div class="badge premium">FOCUS</div>
                                <h3>Ritual 7 Menit Sebelum Belajar</h3>
                                <p>Rapihin meja → set target kecil → matiin notif → minum air → buka materi. Biar otak
                                    “masuk mode”.</p>
                                <div class="meta">🧠 Fokus • ⚡ Cepat • ✅ Konsisten</div>
                            </div>

                            <div class="class-card" tabindex="0">
                                <div class="badge new">TIP</div>
                                <h3>Teknik 25/5 (Pomodoro)</h3>
                                <p>25 menit fokus, 5 menit istirahat. Ulang 3–4 ronde. Setelah itu break lebih panjang.
                                </p>
                                <div class="meta">⏱️ Waktu • 🎯 Fokus • 🔁 Ulang</div>
                            </div>

                            <div class="class-card" tabindex="0">
                                <div class="badge popular">PRO</div>
                                <h3>Belajar “kecil tapi tiap hari”</h3>
                                <p>Lebih menang daripada nunggu mood. Target 10–15 menit pun sah, yang penting rutin.
                                </p>
                                <div class="meta">📆 Konsisten • 📌 Ringan • 🔥 Streak</div>
                            </div>

                            <div class="class-card" tabindex="0">
                                <div class="badge new">ANTI-DRIFT</div>
                                <h3>Kalau mulai terdistraksi…</h3>
                                <p>Tulis gangguan di catatan (parking lot), balik ke materi. Otak tenang karena “nggak
                                    lupa”.</p>
                                <div class="meta">📝 Catatan • 🧊 Tenang • 🎧 Flow</div>
                            </div>
                        </div>

                        <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
                            <button class="btn btn-primary" type="button" data-go="belajar">Praktek di Fokus
                                Mode</button>
                            <button class="btn" type="button" data-go="explore">Cari Materi</button>
                            <button class="btn btn-soft" type="button" id="tipsToast">Ingatkan aku</button>
                        </div>
                    </div>
                </section>
            </section>

            <!-- ROUTE: BELAJAR (Focus Mode) -->
            <section class="route" id="route-belajar" data-route="belajar">
                <section class="learn-shell">
                    <div class="container">
                        <div class="learn-head">
                            <div>
                                <h2>Belajar — Focus Mode ✨</h2>
                                <p>Sidebar materi + viewer + catatan + progres. Semua tersimpan otomatis di perangkat
                                    kamu.</p>
                            </div>
                            <div class="progress" aria-label="Progres belajar">
                                <div class="bar" aria-label="Progress bar"><i id="progressFill"></i></div>
                                <span class="muted" id="progressText">0% selesai</span>
                                <button class="btn" type="button" id="markDone">Tandai Selesai</button>
                                <button class="btn btn-soft" type="button" id="resetProgress">Reset Progres</button>
                            </div>
                        </div>

                        <div class="learn-layout">
                            <!-- Sidebar -->
                            <aside class="panel" aria-label="Daftar pelajaran">
                                <div class="panel-hd">
                                    <strong>Materi</strong>
                                    <span class="small" id="lessonCount">0 item</span>
                                </div>

                                <div class="lesson-list" id="lessonList"></div>
                            </aside>

                            <!-- Main -->
                            <div class="learn-main">
                                <section class="viewer" aria-label="Viewer materi">
                                    <div class="viewer-hd">
                                        <div class="title">
                                            <strong id="viewerTitle">Pilih materi dulu</strong>
                                            <span id="viewerMeta">Preview aman di dalam viewer</span>
                                        </div>
                                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                            <button class="btn" type="button" id="openPreviewModal">Preview
                                                Modal</button>
                                            <button class="btn btn-primary" type="button" id="openExternal">Buka
                                                Sumber</button>
                                        </div>
                                    </div>

                                    <div class="viewer-body">
                                        <div class="viewer-empty" id="viewerEmpty">
                                            <div>
                                                <div style="font-size:16px; font-weight:1000;">📚 Pilih materi dari
                                                    sidebar</div>
                                                <div class="muted" style="margin-top:6px;">Nanti viewer & catatan
                                                    otomatis ikut.</div>
                                            </div>
                                        </div>
                                        <iframe id="viewerFrame" title="Viewer Materi" loading="lazy"
                                            referrerpolicy="no-referrer"></iframe>
                                    </div>
                                </section>

                                <section class="notes" aria-label="Catatan">
                                    <div class="panel-hd">
                                        <strong>Catatan kamu</strong>
                                        <span class="small" id="notesStatus">Auto-save</span>
                                    </div>
                                    <textarea id="notesArea"
                                        placeholder="Tulis poin penting, ringkasan, atau pertanyaan kamu di sini…"></textarea>
                                </section>
                            </div>
                        </div>

                        <footer class="container" style="padding-top:16px;">
                            Tip: gunakan keyboard — <span class="kbd">E</span> Explore, <span class="kbd">T</span> Tips,
                            <span class="kbd">L</span> Belajar, <span class="kbd">/</span> Fokus ke search.
                        </footer>
                    </div>
                </section>
            </section>
        </main>

        <!-- =========================
         MODAL (Preview)
    ========================= -->
        <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <div class="modal-header">
                    <div class="modal-title">
                        <strong id="modalTitle">Preview Materi</strong>
                        <span id="modalSubtitle">Cek dulu sebelum buka link</span>
                    </div>
                    <button class="modal-close" id="modalClose" type="button" aria-label="Tutup">×</button>
                </div>

                <div class="modal-body">
                    <div class="preview" id="modalPreview">
                        <div class="ph" id="modalPlaceholder">Loading preview…</div>
                        <iframe id="modalFrame" title="Preview" loading="lazy" referrerpolicy="no-referrer"></iframe>
                    </div>

                    <div class="modal-info">
                        <div class="info-row">
                            <strong style="font-size:13px; font-weight:1000;">Tentang materi</strong>
                            <p id="modalDesc">—</p>
                        </div>
                        <div class="info-badges" id="modalBadges"></div>
                        <div class="info-row">
                            <p class="muted" id="modalNote">Tip: gunakan preview ini untuk memastikan konten sesuai.</p>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn" type="button" id="modalCancel">Tutup</button>
                    <button class="btn btn-primary" type="button" id="modalUseInFocus">Buka di Focus Mode</button>
                    <button class="btn btn-soft" type="button" id="modalOpenExternal">Buka Sumber</button>
                </div>
            </div>
        </div>

        <!-- =========================
         TOAST
    ========================= -->
        <div class="toast" id="toast" role="status" aria-live="polite">
            <div class="dotty"></div>
            <div>
                <strong id="toastTitle">Berhasil</strong>
                <span id="toastMsg">—</span>
            </div>
            <button id="toastClose" type="button" aria-label="Tutup toast">×</button>
        </div>
    </div>

    <script>
        /* =========================
           Nuqthah Learn — SPA Core (Professional)
           Focus:
           - Clean structure & maintainability
           - No design change, keep all features
           - Smoother UX micro-interactions
           - Stronger error handling (esp. iframe preview)
           - No page auto-scroll (except slider auto sideways)
        ========================= */
        (function () {
            "use strict";

            // -------------------------
            // DOM Helpers
            // -------------------------
            const $ = (sel, root = document) => root.querySelector(sel);
            const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

            const prefersReducedMotion = () =>
                !!(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches);

            const safeJsonParse = (str, fallback) => {
                try { return JSON.parse(str); } catch { return fallback; }
            };

            const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

            const rafThrottle = (fn) => {
                let raf = null;
                return (...args) => {
                    if (raf) return;
                    raf = requestAnimationFrame(() => {
                        raf = null;
                        fn(...args);
                    });
                };
            };

            const debounce = (fn, wait = 140) => {
                let t = null;
                return (...args) => {
                    clearTimeout(t);
                    t = setTimeout(() => fn(...args), wait);
                };
            };

            // -------------------------
            // Storage (safe)
            // -------------------------
            const storage = {
                get(key, fallback) {
                    try {
                        const raw = localStorage.getItem(key);
                        return raw == null ? fallback : safeJsonParse(raw, fallback);
                    } catch {
                        return fallback;
                    }
                },
                set(key, val) {
                    try { localStorage.setItem(key, JSON.stringify(val)); } catch { /* ignore quota */ }
                }
            };

            // -------------------------
            // Toast
            // -------------------------
            const toast = (() => {
                const el = $("#toast");
                const titleEl = $("#toastTitle");
                const msgEl = $("#toastMsg");
                const closeBtn = $("#toastClose");
                let t = null;

                const show = (title, msg, ms = 2600) => {
                    titleEl.textContent = title;
                    msgEl.textContent = msg;
                    el.classList.add("show");
                    clearTimeout(t);
                    t = setTimeout(hide, ms);
                };

                const hide = () => el.classList.remove("show");

                closeBtn.addEventListener("click", hide, { passive: true });

                return { show, hide };
            })();

            // -------------------------
            // Data (example content)
            // -------------------------
            const lessons = [
                {
                    id: "gram-basic",
                    title: "Grammar Dasar: Tenses",
                    desc: "Ringkas, praktis, cocok untuk pemanasan sebelum latihan soal.",
                    category: "Grammar",
                    level: "Beginner",
                    tag: "NEW",
                    featured: true,
                    // -------------------------
                    // link untuk mengarahkan saat menekan tombol "lihat sumber link
                    // -------------------------
                    url: "https://drive.google.com/file/d/1hCRhq5gR_zTk3uvfAAKAr3zZ_d4UrlxF/view?usp=sharing",
                    preview: "https://drive.google.com/file/d/1hCRhq5gR_zTk3uvfAAKAr3zZ_d4UrlxF/view?usp=sharing"
                },
                {
                    id: "speaking-ice",
                    title: "Speaking: Ice Breaking",
                    desc: "Template pembuka obrolan + latihan pengucapan sederhana.",
                    category: "Speaking",
                    level: "Beginner",
                    tag: "POPULAR",
                    featured: true,
                    url: "https://www.bbc.co.uk/learningenglish",
                    preview: "https://www.bbc.co.uk/learningenglish"
                },
                {
                    id: "vocab-daily",
                    title: "Vocabulary: Daily Routine",
                    desc: "Kosa kata yang sering kepake, biar ngomongnya ngalir.",
                    category: "Vocabulary",
                    level: "Beginner",
                    tag: "NEW",
                    featured: false,
                    url: "https://www.oxfordlearnersdictionaries.com/",
                    preview: "https://www.oxfordlearnersdictionaries.com/"
                },
                {
                    id: "reading-skim",
                    title: "Reading: Skimming & Scanning",
                    desc: "Teknik cepat buat cari ide utama dan detail penting.",
                    category: "Reading",
                    level: "Intermediate",
                    tag: "PRO",
                    featured: true,
                    url: "https://en.wikipedia.org/wiki/Reading_(process)",
                    preview: "https://en.wikipedia.org/wiki/Reading_(process)"
                },
                {
                    id: "writing-para",
                    title: "Writing: Paragraph Structure",
                    desc: "Biar tulisan rapih: topic sentence → support → closing.",
                    category: "Writing",
                    level: "Intermediate",
                    tag: "NEW",
                    featured: false,
                    url: "https://owl.purdue.edu/owl/general_writing/academic_writing/paragraphs_and_paragraphing/index.html",
                    preview: "https://owl.purdue.edu/owl/general_writing/academic_writing/paragraphs_and_paragraphing/index.html"
                },
                {
                    id: "toefl-mini",
                    title: "Mini Test: TOEFL Warmup",
                    desc: "Latihan ringan buat ngebangun ritme & confidence.",
                    category: "Test Prep",
                    level: "Intermediate",
                    tag: "PREMIUM",
                    featured: true,
                    url: "https://www.ets.org/toefl",
                    preview: "https://www.ets.org/toefl"
                }
            ];

            const categories = ["All", ...Array.from(new Set(lessons.map(l => l.category)))];

            // -------------------------
            // Keys
            // -------------------------
            const LS = {
                theme: "nql_theme",
                route: "nql_route",
                filters: "nql_filters",
                progress: "nql_progress",
                notes: "nql_notes",
                streak: "nql_streak",
                lastStudy: "nql_last_study"
            };

            const defaultFilters = { q: "", cat: "All" };

            // -------------------------
            // State
            // -------------------------
            const progressStored = storage.get(LS.progress, { activeLessonId: lessons[0]?.id || null, doneMap: {} });
            const state = {
                route: storage.get(LS.route, "home"),
                filters: storage.get(LS.filters, defaultFilters),
                activeLessonId: progressStored.activeLessonId || lessons[0]?.id || null,
                doneMap: progressStored.doneMap || {},
                notesMap: storage.get(LS.notes, {}) || {},
                streak: storage.get(LS.streak, 0) || 0,
                lastStudy: storage.get(LS.lastStudy, null)
            };

            // -------------------------
            // Theme
            // -------------------------
            const stateThemeIsDark = () => document.body.classList.contains("dark");

            const applyTheme = (mode) => {
                const isDark = mode === "dark";
                document.body.classList.toggle("dark", isDark);
                storage.set(LS.theme, mode);
                $("#darkToggle").textContent = isDark ? "☀️" : "🌙";
            };

            const initTheme = () => {
                const saved = (() => {
                    try { return localStorage.getItem(LS.theme); } catch { return null; }
                })();

                if (saved === "dark" || saved === "light") {
                    applyTheme(saved);
                    return;
                }
                const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
                applyTheme(prefersDark ? "dark" : "light");
            };

            // -------------------------
            // Modal (preview) + robust iframe handling
            // -------------------------
            const modal = (() => {
                const overlay = $("#modalOverlay");
                const frame = $("#modalFrame");
                const box = $("#modalPreview");
                const placeholder = $("#modalPlaceholder");
                const title = $("#modalTitle");
                const sub = $("#modalSubtitle");
                const desc = $("#modalDesc");
                const badges = $("#modalBadges");
                const btnClose = $("#modalClose");
                const btnCancel = $("#modalCancel");
                const btnExternal = $("#modalOpenExternal");
                const btnUseInFocus = $("#modalUseInFocus");

                let currentLesson = null;
                let loadTimer = null;

                const setBadges = (lesson) => {
                    badges.innerHTML = "";
                    const arr = [lesson.category, lesson.level, (lesson.tag || "OK")];
                    arr.forEach(x => {
                        const s = document.createElement("span");
                        s.className = "tiny";
                        s.textContent = x;
                        badges.appendChild(s);
                    });
                };

                const setPlaceholder = (text) => {
                    if (placeholder) placeholder.textContent = text;
                };

                const resetFrame = () => {
                    clearTimeout(loadTimer);
                    loadTimer = null;
                    frame.onload = null;
                    frame.onerror = null;
                    frame.src = "";
                    box.classList.remove("ready");
                    setPlaceholder("Loading preview…");
                };

                const tryLoad = (url) => {
                    resetFrame();
                    // if blocked by X-Frame-Options, onload can still fire blank or refuse;
                    // we show a helpful message after timeout if not ready.
                    loadTimer = setTimeout(() => {
                        if (!box.classList.contains("ready")) {
                            setPlaceholder("Preview dibatasi oleh situs (X-Frame-Options). Kamu bisa buka sumber langsung ✅");
                        }
                    }, prefersReducedMotion() ? 0 : 1400);

                    try {
                        frame.src = url;
                        frame.onload = () => {
                            box.classList.add("ready");
                            clearTimeout(loadTimer);
                            loadTimer = null;
                        };
                        frame.onerror = () => {
                            clearTimeout(loadTimer);
                            loadTimer = null;
                            setPlaceholder("Preview gagal dimuat. Buka sumber langsung ✅");
                        };
                    } catch {
                        clearTimeout(loadTimer);
                        loadTimer = null;
                        setPlaceholder("Preview gagal dimuat. Buka sumber langsung ✅");
                    }
                };

                const open = (lesson) => {
                    if (!lesson) return;
                    currentLesson = lesson;

                    title.textContent = lesson.title;
                    sub.textContent = "Preview aman (tidak otomatis buka link)";
                    desc.textContent = lesson.desc;

                    setBadges(lesson);

                    overlay.classList.add("show");
                    overlay.setAttribute("aria-hidden", "false");

                    // Load preview
                    tryLoad(lesson.preview || lesson.url);
                };

                const close = (silent = false) => {
                    overlay.classList.remove("show");
                    overlay.setAttribute("aria-hidden", "true");
                    resetFrame();
                    currentLesson = null;
                    if (!silent) toast.show("Ditutup", "Preview ditutup.");
                };

                // close on outside click
                overlay.addEventListener("click", (e) => {
                    if (e.target === overlay) close(true);
                }, { passive: true });

                [btnClose, btnCancel].forEach(b => b.addEventListener("click", () => close(true), { passive: true }));

                btnExternal.addEventListener("click", () => {
                    if (!currentLesson?.url) return;
                    window.open(currentLesson.url, "_blank", "noopener,noreferrer");
                    toast.show("Dibuka", "Sumber dibuka di tab baru.");
                }, { passive: true });

                btnUseInFocus.addEventListener("click", () => {
                    if (!currentLesson) return;
                    setActiveLesson(currentLesson.id, { announce: true });
                    router.go("belajar");
                    close(true);
                }, { passive: true });

                return { open, close, get current() { return currentLesson; } };
            })();

            // -------------------------
            // Router (clean SPA DOM routing)
            // -------------------------
            const router = (() => {
                const routes = $$(".route");
                let locked = false;

                const activate = (name) => {
                    // hooks
                    if (name === "explore") {
                        explore.syncInputs();
                        explore.render();
                        // focus search (user expects)
                        $("#searchInput")?.focus({ preventScroll: true });
                    }
                    if (name === "belajar") learn.render();
                    if (name === "home") home.renderExtras();
                };

                const go = (to) => {
                    const target = String(to || "home").toLowerCase();
                    const current = state.route;

                    if (target === current) return;
                    if (locked) return;
                    locked = true;

                    const currentEl = $(`#route-${current}`);
                    const nextEl = $(`#route-${target}`);

                    if (!nextEl) {
                        toast.show("Error", "Halaman tidak ditemukan. Balik ke Home.");
                        locked = false;
                        return go("home");
                    }

                    // Close modal if open
                    modal.close(true);

                    // transition out
                    if (currentEl) {
                        currentEl.classList.remove("enter");
                        currentEl.classList.add("leave");
                    }

                    const duration = prefersReducedMotion() ? 0 : 420;

                    setTimeout(() => {
                        routes.forEach(r => r.classList.remove("active", "enter", "leave"));

                        nextEl.classList.add("active");
                        requestAnimationFrame(() => nextEl.classList.add("enter"));

                        state.route = target;
                        storage.set(LS.route, state.route);

                        // IMPORTANT: no auto-scroll page (user request)
                        // (We intentionally do not scrollTo here.)

                        activate(target);
                        locked = false;
                    }, duration);
                };

                return { go };
            })();

            // -------------------------
            // Slider (auto-scroll sideways + dots + pause on hover)
            // -------------------------
            const slider = (() => {
                const wrap = $("#featuredSlider");
                const dotsWrap = $("#sliderDots");

                let idx = 0;
                let timer = null;
                let items = [];

                const escapeXml = (str) => String(str || "").replace(/[<>&'"]/g, (c) => ({
                    "<": "&lt;", ">": "&gt;", "&": "&amp;", "'": "&apos;", '"': "&quot;"
                }[c]));

                const build = () => {
                    items = lessons.filter(l => l.featured);
                    wrap.innerHTML = "";
                    dotsWrap.innerHTML = "";

                    const frag = document.createDocumentFragment();

                    items.forEach((l, i) => {
                        const s = document.createElement("div");
                        s.className = "slide";
                        s.tabIndex = 0;
                        s.setAttribute("role", "button");
                        s.setAttribute("aria-label", `Buka preview: ${l.title}`);

                        const img = document.createElement("img");
                        img.alt = l.title;
                        img.loading = "lazy";
                        img.decoding = "async";
                        img.src = `data:image/svg+xml,${encodeURIComponent(`
              <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700">
                <defs>
                  <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                    <stop offset="0" stop-color="${stateThemeIsDark() ? "#1b2a55" : "#2563eb"}"/>
                    <stop offset="1" stop-color="${stateThemeIsDark() ? "#0b1220" : "#4f46e5"}"/>
                  </linearGradient>
                </defs>
                <rect width="1200" height="700" fill="url(#g)"/>
                <circle cx="280" cy="160" r="220" fill="rgba(255,255,255,0.12)"/>
                <circle cx="980" cy="520" r="260" fill="rgba(34,197,94,0.12)"/>
                <text x="70" y="520" fill="rgba(255,255,255,0.92)" font-size="56" font-family="system-ui" font-weight="800">${escapeXml(l.category)}</text>
                <text x="70" y="590" fill="rgba(255,255,255,0.82)" font-size="36" font-family="system-ui" font-weight="700">${escapeXml(l.level)}</text>
              </svg>
            `)}`;

                        const tag = document.createElement("div");
                        tag.className = "tag";
                        tag.textContent = l.category;

                        const badge = document.createElement("div");
                        badge.className = "badge-right";
                        badge.textContent = l.tag === "PREMIUM" ? "PREMIUM" : "Recommended";

                        const title = document.createElement("span");
                        title.textContent = l.title;

                        s.appendChild(img);
                        s.appendChild(tag);
                        s.appendChild(badge);
                        s.appendChild(title);

                        const openPreview = () => modal.open(l);

                        s.addEventListener("click", openPreview, { passive: true });
                        s.addEventListener("keydown", (e) => {
                            if (e.key === "Enter" || e.key === " ") {
                                e.preventDefault();
                                openPreview();
                            }
                        });

                        frag.appendChild(s);

                        const d = document.createElement("div");
                        d.className = "dot" + (i === 0 ? " active" : "");
                        d.addEventListener("click", () => jump(i), { passive: true });
                        dotsWrap.appendChild(d);
                    });

                    wrap.appendChild(frag);
                };

                const updateDots = () => {
                    $$(".dot", dotsWrap).forEach((d, i) => d.classList.toggle("active", i === idx));
                };

                const jump = (i) => {
                    idx = clamp(i, 0, items.length - 1);
                    const target = wrap.children[idx];
                    if (!target) return;

                    wrap.scrollTo({
                        left: target.offsetLeft,
                        behavior: prefersReducedMotion() ? "auto" : "smooth"
                    });

                    updateDots();
                };


                const start = () => {
                    stop();
                    if (items.length <= 1) return;
                    timer = setInterval(() => {
                        idx = (idx + 1) % items.length;
                        jump(idx);
                    }, 4200);
                };

                const stop = () => {
                    if (timer) clearInterval(timer);
                    timer = null;
                };

                wrap.addEventListener("mouseenter", stop, { passive: true });
                wrap.addEventListener("mouseleave", start, { passive: true });

                wrap.addEventListener("scroll", rafThrottle(() => {
                    const children = Array.from(wrap.children);
                    if (!children.length) return;
                    const left = wrap.scrollLeft;
                    let best = 0, bestDist = Infinity;
                    children.forEach((c, i) => {
                        const dist = Math.abs(c.offsetLeft - left);
                        if (dist < bestDist) { bestDist = dist; best = i; }
                    });
                    idx = best;
                    updateDots();
                }), { passive: true });

                return { build, start, stop, jump };
            })();

            // -------------------------
            // Explore (search + chips + grid + skeleton)
            // -------------------------
            const explore = (() => {
                const grid = $("#classGrid");
                const skeletonGrid = $("#skeletonGrid");
                const chipsWrap = $("#categoryChips");
                const qInput = $("#searchInput");
                const clearBtn = $("#clearSearch");
                const resetBtn = $("#resetFilters");

                const showSkeleton = (on) => {
                    skeletonGrid.style.display = on ? "" : "none";
                    grid.style.display = on ? "none" : "";
                };

                const buildSkeleton = () => {
                    skeletonGrid.innerHTML = "";
                    for (let i = 0; i < 6; i++) {
                        const sk = document.createElement("div");
                        sk.className = "skeleton shimmer";
                        skeletonGrid.appendChild(sk);
                    }
                };

                const buildChips = () => {
                    chipsWrap.innerHTML = "";
                    const frag = document.createDocumentFragment();
                    categories.forEach(cat => {
                        const c = document.createElement("span");
                        c.className = "chip" + (state.filters.cat === cat ? " active" : "");
                        c.textContent = cat;
                        c.addEventListener("click", () => {
                            state.filters.cat = cat;
                            storage.set(LS.filters, state.filters);
                            render();
                        }, { passive: true });
                        frag.appendChild(c);
                    });
                    chipsWrap.appendChild(frag);
                };

                const computeFiltered = () => {
                    const q = (state.filters.q || "").trim().toLowerCase();
                    const cat = state.filters.cat;

                    return lessons.filter(l => {
                        const okCat = (cat === "All") || (l.category === cat);
                        const hay = `${l.title} ${l.desc} ${l.category} ${l.level}`.toLowerCase();
                        const okQ = !q || hay.includes(q);
                        return okCat && okQ;
                    });
                };

                const render = () => {
                    buildChips();
                    showSkeleton(true);
                    clearBtn.style.display = state.filters.q ? "grid" : "none";

                    const filtered = computeFiltered();

                    setTimeout(() => {
                        grid.innerHTML = "";
                        const frag = document.createDocumentFragment();

                        filtered.forEach(l => {
                            const card = document.createElement("div");
                            card.className = "class-card" + (l.tag === "PREMIUM" ? " elite" : "");
                            card.tabIndex = 0;

                            const badge = document.createElement("div");
                            badge.className = "badge " + (
                                l.tag === "PREMIUM" ? "premium" :
                                    l.tag === "POPULAR" ? "popular" : "new"
                            );
                            badge.textContent = l.tag || "NEW";

                            const h = document.createElement("h3");
                            h.textContent = l.title;

                            const p = document.createElement("p");
                            p.textContent = l.desc;

                            const meta = document.createElement("div");
                            meta.className = "meta";
                            meta.textContent = `🏷️ ${l.category} • 🎚️ ${l.level}`;

                            card.appendChild(badge);
                            card.appendChild(h);
                            card.appendChild(p);
                            card.appendChild(meta);

                            const openPreview = () => modal.open(l);
                            card.addEventListener("click", openPreview, { passive: true });
                            card.addEventListener("keydown", (e) => {
                                if (e.key === "Enter" || e.key === " ") {
                                    e.preventDefault();
                                    openPreview();
                                }
                            });

                            frag.appendChild(card);
                        });

                        if (!filtered.length) {
                            const empty = document.createElement("div");
                            empty.className = "class-card";
                            empty.style.gridColumn = "1 / -1";
                            empty.innerHTML = `<h3>Tidak ada hasil</h3><p>Coba kata kunci lain atau ganti kategori.</p><div class="meta">💡 Tip: klik Reset</div>`;
                            frag.appendChild(empty);
                        }

                        grid.appendChild(frag);
                        showSkeleton(false);
                    }, prefersReducedMotion() ? 0 : 200);
                };

                const bind = () => {
                    buildSkeleton();

                    const onInput = debounce(() => {
                        state.filters.q = qInput.value;
                        storage.set(LS.filters, state.filters);
                        render();
                    }, prefersReducedMotion() ? 0 : 120);

                    qInput.addEventListener("input", onInput, { passive: true });

                    clearBtn.addEventListener("click", () => {
                        qInput.value = "";
                        state.filters.q = "";
                        storage.set(LS.filters, state.filters);
                        render();
                        qInput.focus({ preventScroll: true });
                    }, { passive: true });

                    resetBtn.addEventListener("click", () => {
                        state.filters = { ...defaultFilters };
                        storage.set(LS.filters, state.filters);
                        qInput.value = "";
                        render();
                        toast.show("Reset", "Filter dikembalikan ke default.");
                    }, { passive: true });
                };

                const syncInputs = () => {
                    qInput.value = state.filters.q || "";
                    clearBtn.style.display = state.filters.q ? "grid" : "none";
                };

                return { render, bind, syncInputs };
            })();

            // -------------------------
            // Learn (Focus mode)
            // -------------------------
            const learn = (() => {
                const listEl = $("#lessonList");
                const countEl = $("#lessonCount");
                const viewerFrame = $("#viewerFrame");
                const viewerEmpty = $("#viewerEmpty");
                const viewerTitle = $("#viewerTitle");
                const viewerMeta = $("#viewerMeta");
                const notesArea = $("#notesArea");
                const notesStatus = $("#notesStatus");
                const progressFill = $("#progressFill");
                const progressText = $("#progressText");

                const btnMarkDone = $("#markDone");
                const btnResetProgress = $("#resetProgress");
                const btnOpenModal = $("#openPreviewModal");
                const btnOpenExternal = $("#openExternal");

                let saveTimer = null;
                let viewerTimer = null;

                const computeProgress = () => {
                    const total = lessons.length;
                    const doneCount = lessons.filter(l => state.doneMap[l.id]).length;
                    const pct = total ? Math.round((doneCount / total) * 100) : 0;
                    return { total, doneCount, pct };
                };

                const renderProgress = () => {
                    const { doneCount, total, pct } = computeProgress();
                    progressFill.style.width = `${pct}%`;
                    progressText.textContent = `${pct}% selesai (${doneCount}/${total})`;
                    $("#statProgress").textContent = `${pct}%`;
                    $("#statTotal").textContent = `${total}`;
                };

                const lessonBadgeClass = (lesson) => {
                    if (state.doneMap[lesson.id]) return "ok";
                    if (lesson.tag === "PREMIUM") return "lock";
                    return "warn";
                };

                const renderList = () => {
                    listEl.innerHTML = "";
                    const frag = document.createDocumentFragment();

                    lessons.forEach(lesson => {
                        const it = document.createElement("div");
                        it.className = "lesson-item" + (lesson.id === state.activeLessonId ? " active" : "");
                        it.tabIndex = 0;

                        const b = document.createElement("b");
                        b.textContent = lesson.title;

                        const sm = document.createElement("small");
                        sm.textContent = lesson.desc;

                        const row = document.createElement("div");
                        row.className = "row";

                        const p1 = document.createElement("span");
                        p1.className = "pill-mini";
                        p1.textContent = lesson.category;

                        const p2 = document.createElement("span");
                        p2.className = "pill-mini";
                        p2.textContent = lesson.level;

                        const p3 = document.createElement("span");
                        p3.className = `pill-mini ${lessonBadgeClass(lesson)}`;
                        p3.textContent = state.doneMap[lesson.id] ? "Selesai" : (lesson.tag === "PREMIUM" ? "Premium" : "Belum");

                        row.appendChild(p1);
                        row.appendChild(p2);
                        row.appendChild(p3);

                        it.appendChild(b);
                        it.appendChild(sm);
                        it.appendChild(row);

                        const act = () => setActiveLesson(lesson.id, { announce: true });
                        it.addEventListener("click", act, { passive: true });
                        it.addEventListener("keydown", (e) => {
                            if (e.key === "Enter" || e.key === " ") {
                                e.preventDefault();
                                act();
                            }
                        });

                        frag.appendChild(it);
                    });

                    listEl.appendChild(frag);
                    countEl.textContent = `${lessons.length} item`;
                };

                const loadViewer = (lesson) => {
                    if (!lesson) return;

                    viewerTitle.textContent = lesson.title;
                    viewerMeta.textContent = `${lesson.category} • ${lesson.level} • ${state.doneMap[lesson.id] ? "Selesai ✅" : "Belum selesai"}`;

                    viewerEmpty.style.display = "none";
                    viewerFrame.style.display = "block";

                    clearTimeout(viewerTimer);
                    viewerTimer = null;

                    viewerFrame.src = "";
                    try {
                        // Similar to modal: some sites block iframe. We keep UX stable; viewer is optional.
                        viewerFrame.src = lesson.preview || lesson.url;

                        viewerTimer = setTimeout(() => {
                            // If iframe content blocked, user can still open external.
                            // We avoid intrusive UI changes to keep design consistent.
                            // (Toast only, soft feedback)
                            toast.show("Info", "Kalau viewer kosong, kemungkinan situs membatasi iframe. Klik “Buka Sumber”.", 3200);
                        }, prefersReducedMotion() ? 0 : 1600);
                    } catch {
                        toast.show("Error", "Gagal memuat viewer. Coba buka sumber.");
                    }
                };

                const syncNotes = (lessonId) => {
                    const text = state.notesMap[lessonId] || "";
                    notesArea.value = text;
                    notesStatus.textContent = "Auto-save";
                };

                const queueSaveNotes = () => {
                    clearTimeout(saveTimer);
                    notesStatus.textContent = "Menyimpan…";
                    saveTimer = setTimeout(() => {
                        const id = state.activeLessonId;
                        if (!id) return;
                        state.notesMap[id] = notesArea.value;
                        storage.set(LS.notes, state.notesMap);
                        notesStatus.textContent = "Tersimpan ✅";
                    }, prefersReducedMotion() ? 0 : 360);
                };

                const bumpStreak = () => {
                    const today = new Date();
                    const ymd = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, "0")}-${String(today.getDate()).padStart(2, "0")}`;

                    const last = state.lastStudy;
                    if (last === ymd) return;

                    const yesterday = new Date(today);
                    yesterday.setDate(today.getDate() - 1);
                    const ymdY = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, "0")}-${String(yesterday.getDate()).padStart(2, "0")}`;

                    state.streak = (last === ymdY) ? (state.streak + 1) : 1;
                    state.lastStudy = ymd;

                    storage.set(LS.streak, state.streak);
                    storage.set(LS.lastStudy, state.lastStudy);

                    $("#statStreak").textContent = `${state.streak}🔥`;
                };

                const markDone = () => {
                    const id = state.activeLessonId;
                    if (!id) return;
                    state.doneMap[id] = true;
                    storage.set(LS.progress, { activeLessonId: state.activeLessonId, doneMap: state.doneMap });
                    bumpStreak();
                    renderList();
                    renderProgress();
                    toast.show("Nice!", "Materi ditandai selesai. Progres tersimpan.");
                };

                const resetProgress = () => {
                    state.doneMap = {};
                    storage.set(LS.progress, { activeLessonId: state.activeLessonId, doneMap: state.doneMap });
                    renderList();
                    renderProgress();
                    toast.show("Reset", "Progres direset.");
                };

                const bind = () => {
                    notesArea.addEventListener("input", queueSaveNotes, { passive: true });

                    btnMarkDone.addEventListener("click", markDone, { passive: true });
                    btnResetProgress.addEventListener("click", resetProgress, { passive: true });

                    btnOpenModal.addEventListener("click", () => {
                        const lesson = lessons.find(l => l.id === state.activeLessonId);
                        if (!lesson) return toast.show("Info", "Pilih materi dulu ya.");
                        modal.open(lesson);
                    }, { passive: true });

                    btnOpenExternal.addEventListener("click", () => {
                        const lesson = lessons.find(l => l.id === state.activeLessonId);
                        if (!lesson?.url) return toast.show("Info", "Pilih materi dulu ya.");
                        window.open(lesson.url, "_blank", "noopener,noreferrer");
                        toast.show("Dibuka", "Sumber dibuka di tab baru.");
                    }, { passive: true });
                };

                const select = (lessonId, { announce = false } = {}) => {
                    const lesson = lessons.find(l => l.id === lessonId);
                    if (!lesson) return;

                    state.activeLessonId = lesson.id;
                    storage.set(LS.progress, { activeLessonId: state.activeLessonId, doneMap: state.doneMap });

                    renderList();
                    renderProgress();
                    loadViewer(lesson);
                    syncNotes(lesson.id);

                    if (announce) toast.show("Siap", `Materi aktif: ${lesson.title}`);
                };

                const render = () => {
                    renderList();
                    renderProgress();

                    // stats (home)
                    $("#statTotal").textContent = `${lessons.length}`;
                    $("#statStreak").textContent = `${state.streak}🔥`;

                    // sync selected
                    const active = lessons.find(l => l.id === state.activeLessonId) || lessons[0];
                    if (active) {
                        state.activeLessonId = active.id;
                        storage.set(LS.progress, { activeLessonId: state.activeLessonId, doneMap: state.doneMap });
                        loadViewer(active);
                        syncNotes(active.id);
                    } else {
                        viewerTitle.textContent = "Pilih materi dulu";
                        viewerMeta.textContent = "Preview aman di dalam viewer";
                        viewerEmpty.style.display = "";
                    }
                };

                return { render, bind, select };
            })();

            // -------------------------
            // Global: setActiveLesson (used by modal + learn list)
            // -------------------------
            function setActiveLesson(id, opts) {
                learn.select(id, opts);
            }

            // -------------------------
            // Home extras (quick chips + stats)
            // -------------------------
            const home = (() => {
                const quickWrap = $("#homeQuickChips");

                const renderQuickChips = () => {
                    if (!quickWrap) return;
                    quickWrap.innerHTML = "";
                    const tops = categories.filter(c => c !== "All").slice(0, 6);

                    tops.forEach(cat => {
                        const s = document.createElement("span");
                        s.className = "chip";
                        s.textContent = cat;
                        s.addEventListener("click", () => {
                            state.filters.cat = cat;
                            storage.set(LS.filters, state.filters);
                            router.go("explore");
                            toast.show("Filter", `Kategori: ${cat}`);
                        }, { passive: true });
                        quickWrap.appendChild(s);
                    });
                };

                const renderStats = () => {
                    const total = lessons.length;
                    const doneCount = lessons.filter(l => state.doneMap[l.id]).length;
                    const pct = total ? Math.round((doneCount / total) * 100) : 0;

                    $("#statTotal").textContent = `${total}`;
                    $("#statProgress").textContent = `${pct}%`;
                    $("#statStreak").textContent = `${state.streak}🔥`;
                };

                const renderExtras = () => {
                    renderQuickChips();
                    renderStats();
                    slider.build();
                    slider.start();
                };

                return { renderExtras };
            })();

            // -------------------------
            // Navbar + global binds
            // -------------------------
            const bindGlobal = () => {
                // year
                $("#year").textContent = new Date().getFullYear();

                // theme init + toggle
                initTheme();
                $("#darkToggle").addEventListener("click", () => {
                    // matikan animasi/transition sebentar biar ga “lag”
                    document.body.classList.add("theme-switching");

                    applyTheme(stateThemeIsDark() ? "light" : "dark");

                    // rebuild slider gradient SVG supaya nyambung tema (tetap)
                    if (state.route === "home") {
                        slider.build();
                        slider.start();
                    }

                    // balikin transition setelah frame render selesai
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            document.body.classList.remove("theme-switching");
                        });
                    });
                }, { passive: true });


                // data-go routing
                $$("[data-go]").forEach(el => {
                    const go = el.getAttribute("data-go");
                    if (!go) return;

                    const handler = (e) => {
                        // allow click on chips inside cards too
                        e?.preventDefault?.();
                        router.go(go);
                    };

                    el.addEventListener("click", handler, { passive: false });
                    el.addEventListener("keydown", (e) => {
                        if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            router.go(go);
                        }
                    });
                });

                // tips toast button
                $("#tipsToast")?.addEventListener("click", () => {
                    toast.show("Reminder", "Target kecil dulu: 10–15 menit. Yang penting konsisten 🔥", 3400);
                }, { passive: true });

                // keyboard shortcuts
                window.addEventListener("keydown", (e) => {
                    // Esc closes modal
                    if (e.key === "Escape") {
                        modal.close(true);
                        return;
                    }

                    // Ignore when typing
                    const tag = (document.activeElement?.tagName || "").toLowerCase();
                    const typing = tag === "input" || tag === "textarea";
                    if (typing) return;

                    if (e.key === "e" || e.key === "E") router.go("explore");
                    if (e.key === "t" || e.key === "T") router.go("tips");
                    if (e.key === "l" || e.key === "L") router.go("belajar");

                    if (e.key === "/") {
                        e.preventDefault();
                        router.go("explore");
                        // focus is handled in router.activate("explore")
                    }
                });

                // prevent background scroll when modal open (nice UX)
                const overlay = $("#modalOverlay");
                const lockScroll = () => document.body.style.overflow = "hidden";
                const unlockScroll = () => document.body.style.overflow = "";

                const obs = new MutationObserver((mutations) => {
                    mutations.forEach(m => {
                        if (m.target.classList.contains("open")) {
                            lockScroll();
                        } else {
                            unlockScroll();
                        }
                    });
                });
                obs.observe(overlay, { attributes: true, attributeFilter: ["class"] });

                // init explore + learn binds
                explore.bind();
                learn.bind();
            };

            // -------------------------
            // Boot
            // -------------------------
            const boot = () => {
                bindGlobal();

                // initial renders
                home.renderExtras();
                explore.render();
                learn.render();

                // go to saved route (no auto-scroll)
                router.go(state.route || "home");

                // tiny welcome toast (subtle)
                toast.show("Siap!", "Semua tersimpan otomatis: tema, filter, progres, catatan.", 2400);
            };

            // Start
            boot();
        })();
    </script>
</body>

</html>